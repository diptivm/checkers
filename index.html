<!DOCTYPE html>

<!--
  COLLABORATORS:
  
-->
<html>

<head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
  <title>Checkerboard</title>

  <!-- Load style sheets -->
  <link rel="stylesheet" type="text/css" href="mainLayout.css" />

  <!-- Load any supplemental Javascript libraries here -->
  <script type="text/javascript" src="external_js/jquery-1.9.0.min.js"></script>
  <script type="text/javascript" src="checker.js"></script>
  <script type="text/javascript" src="boardEvent.js"></script>
  <script type="text/javascript" src="board.js"></script>
  <script type="text/javascript" src="rules.js"></script>

  <script type="text/javascript">

//This script extracts parameters from the URL
//from jquery-howto.blogspot.com

$.extend({
  getUrlVars : function() {
    var vars = [], hash;
    var hashes = window.location.href.slice(
      window.location.href.indexOf('?') + 1).split('&');
    for ( var i = 0; i < hashes.length; i++) {
      hash = hashes[i].split('=');
      vars.push(hash[0]);
      vars[hash[0]] = hash[1];
    }
    return vars;
  },
  getUrlVar : function(name) {
    return $.getUrlVars()[name];
  }
});

var DEFAULT_BOARD_SIZE = 8;
var BOARD_SIZE = DEFAULT_BOARD_SIZE;

var c;
var ctx;

    //data model
    var board;
    var rules;
    var whoseTurn = "black";	

    var directionOf = function(color) {
      if (color == "black") {
        return -1;
      }
      return 1;
    }

    // Fill in this function to toggle the display for whose turn
    // The color parameter should be either "black" or "red"
    var toggleTurn = function(color) {
     if("black" == whoseTurn) {
      whoseTurn = "red";
    }
    else if("red" == whoseTurn) {
      whoseTurn = "black";
    }
    // Your code here
  }



    // This allows the Javascript code inside this block to only run when the page
    // has finished loading in the browser.
    $(document).ready(function() {

      if ($.getUrlVar('size') && $.getUrlVar('size') >= 6) {
        BOARD_SIZE = $.getUrlVar('size');
        board = new Board($.getUrlVar('size'));
      } else {
        BOARD_SIZE = DEFAULT_BOARD_SIZE;
        board = new Board(DEFAULT_BOARD_SIZE);
      }


      rules = new Rules(board);

     	// Your code here
      c = document.getElementById('checkerBoard');
      ctx = c.getContext('2d');

      board.addEventListener('add',function (e) {
        drawBoard();
        drawCheckers();
            // Your code here
          },true);

      board.addEventListener('move',function (e) {
       drawBoard();
       drawCheckers();
            // Your code here
          },true);

      board.addEventListener('remove', function(e) {
        drawBoard();
        drawCheckers();
            // Your code here
          }, true);

      board.addEventListener('promote',function (e) {
        drawBoard();
        drawCheckers();
            // Your code here
          },true);


      $("#btnNewGame").click(function(evt) {
        board.prepareNewGame();
      });

      $("#btnAutoMove").click(function(evt) {
        var playerColor = whoseTurn;
        var playerDirection = directionOf(playerColor);
        var result = rules.makeRandomMove(playerColor, playerDirection);
        if (result != null) {
          toggleTurn();
        }
      });

      board.prepareNewGame();

    });
</script>


</head>

<body>

  <table id="mainTable">
    <tr id = "main">
      <td id="navigation">
        <div class = "fixed-height">
          <div class = "table-vert-align">
          <div class = "vert-align-middle">
          <table>
           <tr><td><span id = "turn-feedback">	</span> <!-- Your code here -->			</td></tr>
           <tr><td><input id="btnNewGame" type="button" name="new" value="New Game"/></td></tr>
           <tr><td><input id="btnAutoMove" type="button" name="new" value="Auto Move"/></td></tr>
         </div>
       </div>
         </div>
       </table>
     </td>

     <td id="content">
      <div class = "fixed-height">
       <canvas id = "checkerBoard" width = "400" height = "400"> This browser does not support the HTML5 canvas tag. </canvas> 
       <!-- Your code here -->
     </div>
   </td>
 </tr>

</table>
<img id="red-piece" src="graphics/red-piece.png" alt="Red Piece" width="0" height="0">
<img id="black-piece" src="graphics/black-piece.png" alt="Red Piece" width="0" height="0">
<img id="red-king" src="graphics/red-king.png" alt="Red Piece" width="0" height="0">
<img id="black-king" src="graphics/black-king.png" alt="Red Piece" width="0" height="0">

<script>
var sqSize;

var getCheckerImage = function(checkerName) {
  var img = null;
  if(checkerName == 'red') {
    img = document.getElementById("red-piece");
  }
  else if(checkerName == 'black'){
   img = document.getElementById("black-piece");
 }
 else if(checkerName == 'RED'){
   img = document.getElementById("red-king");
 }
 else if(checkerName == 'BLACK'){
   img = document.getElementById("black-king");
 }
 return img;
}

drawCheckers = function() {
  var currChecker;
  var currCheckerName;
  var currCheckerImage;

  for(i = 0; i < BOARD_SIZE; i++) {
    for(j = 0; j < BOARD_SIZE; j++) {
      currChecker = board.getCheckerAt(i,j);
      if(currChecker != null) {
        currCheckerName = currChecker.toString();
        console.log("Checker " + currCheckerName + " found at " + i + "," + j);
        currCheckerImage = getCheckerImage(currCheckerName);
        if(currCheckerImage != null) {
          ctx.drawImage(currCheckerImage,sqSize*j, sqSize*i,sqSize, sqSize);
        }
      }
    }
  }
}

drawBoard = function() {
  ctx.fillStyle = "gray";
  ctx.fillRect(0,0,400,400);
  ctx.fillStyle = "#ffffff";
  for(var i = 0; i < BOARD_SIZE; i++) {
   for(var j = 0; j < BOARD_SIZE/2; j++) {
    ctx.fillRect(sqSize*(i%2) + 2*sqSize*j,sqSize*i,sqSize,sqSize);
  } 
}
}

$(document).ready( function() {
    //console.log(BOARD_SIZE);
    sqSize = 400/BOARD_SIZE;
    //console.log(sqSize);

    c = document.getElementById('checkerBoard');
    ctx = c.getContext('2d');

    drawBoard();

    window.onload  = function() {
      console.log("window load");
      drawCheckers();
    }

  });

</script>
</body>

</html>
